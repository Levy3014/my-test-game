<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hex Conquest - Expanded</title>
<style>
  body {
    margin: 0; padding: 0; background: #222; color: white;
    font-family: Arial, sans-serif;
    user-select: none;
    display: flex;
    height: 100vh;
    overflow: hidden;
  }
  #container {
    flex: 1;
    display: flex;
    flex-direction: column;
    max-width: 900px;
    margin: 0 auto;
    user-select: none;
  }
  canvas {
    background: #333;
    border-radius: 8px;
    border: 2px solid #555;
    flex: 1;
  }
  #sidebar {
    width: 300px;
    background: #111;
    padding: 20px;
    box-sizing: border-box;
    border-left: 2px solid #444;
    display: flex;
    flex-direction: column;
  }
  button {
    background: #3498db;
    border: none;
    padding: 10px 20px;
    margin: 8px 0;
    font-size: 16px;
    color: white;
    cursor: pointer;
    border-radius: 6px;
  }
  button:disabled {
    background: #555;
    cursor: not-allowed;
  }
  h2, h3 {
    margin: 10px 0 5px 0;
  }
  #tooltip {
    position: absolute;
    background: #222;
    color: #eee;
    border: 1px solid #555;
    padding: 6px 8px;
    border-radius: 4px;
    pointer-events: none;
    font-size: 14px;
    visibility: hidden;
    max-width: 200px;
    z-index: 10;
  }
  #playerInfo {
    margin-bottom: 10px;
  }
  .unit-icon {
    display: inline-block;
    width: 20px; height: 20px;
    margin-right: 5px;
    vertical-align: middle;
  }
  .unit-icon.soldier {
    background: url('https://img.icons8.com/ios-filled/50/ffffff/soldier-helmet.png') no-repeat center center;
    background-size: contain;
  }
  .unit-icon.fort {
    background: url('https://img.icons8.com/ios-filled/50/ffffff/castle.png') no-repeat center center;
    background-size: contain;
  }
  #phaseDisplay {
    margin-bottom: 15px;
    font-weight: bold;
    font-size: 18px;
  }
  #moneyDisplay {
    margin-bottom: 15px;
  }
  #shop {
    border-top: 1px solid #444;
    padding-top: 15px;
    flex-grow: 1;
  }
  #shop button {
    width: 100%;
  }
</style>
</head>
<body>

<div id="container">
  <canvas id="canvas" width="900" height="800"></canvas>
  <div id="tooltip"></div>
</div>

<div id="sidebar">
  <div id="playerInfo"></div>
  <div id="moneyDisplay"></div>
  <div id="phaseDisplay"></div>

  <div id="shop">
    <h3>Shop</h3>
    <button id="buySoldier" disabled>Buy Soldier (10 Gold)</button>
    <button id="buildFort" disabled>Build Fort (20 Gold)</button>
  </div>

  <button id="endTurnBtn" disabled>End Turn</button>
</div>

<script>
// GAME STATE VARIABLES
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const tooltip = document.getElementById('tooltip');
const playerInfo = document.getElementById('playerInfo');
const moneyDisplay = document.getElementById('moneyDisplay');
const phaseDisplay = document.getElementById('phaseDisplay');
const endTurnBtn = document.getElementById('endTurnBtn');
const buySoldierBtn = document.getElementById('buySoldier');
const buildFortBtn = document.getElementById('buildFort');

const hexRadius = 40;
const hexHeight = Math.sqrt(3) * hexRadius;
const gridCols = 10;
const gridRows = 10;

let currentPlayerIndex = 0;
let currentPhase = 'placement'; // 'placement', 'action', 'end'

let players = [
  { id: 1, name: 'Player 1', color: '#f00', money: 20, tiles: [], soldiers: [], forts: [] },
  { id: 2, name: 'Player 2', color: '#0f0', money: 20, tiles: [], soldiers: [], forts: [] },
];

let hexes = [];

function createHexGrid() {
  hexes = [];
  for (let row = 0; row < gridRows; row++) {
    for (let col = 0; col < gridCols; col++) {
      const x = col * 1.5 * hexRadius + 60;
      const y = row * hexHeight + (col % 2 === 0 ? 60 : 60 + hexHeight / 2);
      hexes.push({
        x, y, col, row,
        owner: null,
        soldier: null,
        fort: false,
      });
    }
  }
}

function drawHex(x, y, radius, color, fill = false) {
  const angle = Math.PI / 3;
  ctx.beginPath();
  for (let i = 0; i < 6; i++) {
    const dx = x + radius * Math.cos(angle * i);
    const dy = y + radius * Math.sin(angle * i);
    ctx.lineTo(dx, dy);
  }
  ctx.closePath();
  if (fill) {
    ctx.fillStyle = color;
    ctx.fill();
  }
  ctx.strokeStyle = color;
  ctx.stroke();
}

function drawGrid() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  hexes.forEach(hex => {
    const color = hex.owner ? hex.owner.color : '#666';
    drawHex(hex.x, hex.y, hexRadius, color, true);
    if (hex.fort) {
      ctx.fillStyle = '#fff';
      ctx.font = '16px sans-serif';
      ctx.fillText('ðŸ°', hex.x - 10, hex.y + 6);
    }
    if (hex.soldier) {
      ctx.fillStyle = '#fff';
      ctx.font = '16px sans-serif';
      ctx.fillText('âš”ï¸', hex.x - 8, hex.y + 6);
    }
  });
}

function getHexAt(x, y) {
  return hexes.find(hex => Math.hypot(hex.x - x, hex.y - y) < hexRadius);
}

function updateUI() {
  const player = players[currentPlayerIndex];
  playerInfo.textContent = `${player.name}`;
  moneyDisplay.textContent = `Gold: ${player.money}`;
  phaseDisplay.textContent = `Phase: ${currentPhase}`;
  const actionPhase = currentPhase === 'action';
  endTurnBtn.disabled = !actionPhase;
  buySoldierBtn.disabled = !actionPhase || player.money < 10;
  buildFortBtn.disabled = !actionPhase || player.money < 20;
}

canvas.addEventListener('click', e => {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const hex = getHexAt(x, y);
  if (!hex) return;
  const player = players[currentPlayerIndex];

  if (currentPhase === 'placement' && !hex.owner) {
    hex.owner = player;
    player.tiles.push(hex);
    currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
    if (currentPlayerIndex === 0) currentPhase = 'action';
    updateUI();
    drawGrid();
  }
});

buySoldierBtn.onclick = () => {
  const player = players[currentPlayerIndex];
  const tile = player.tiles.find(t => !t.soldier);
  if (tile && player.money >= 10) {
    tile.soldier = true;
    player.money -= 10;
    player.soldiers.push(tile);
    updateUI();
    drawGrid();
  }
};

buildFortBtn.onclick = () => {
  const player = players[currentPlayerIndex];
  const tile = player.tiles.find(t => !t.fort);
  if (tile && player.money >= 20) {
    tile.fort = true;
    player.money -= 20;
    player.forts.push(tile);
    updateUI();
    drawGrid();
  }
};

endTurnBtn.onclick = () => {
  currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
  if (currentPlayerIndex === 0) {
    players.forEach(p => p.money += 5);
  }
  updateUI();
  drawGrid();
};

canvas.addEventListener('mousemove', e => {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const hex = getHexAt(x, y);
  if (hex) {
    tooltip.style.visibility = 'visible';
    tooltip.style.left = `${e.pageX + 10}px`;
    tooltip.style.top = `${e.pageY + 10}px`;
    tooltip.innerHTML = `Tile [${hex.col},${hex.row}]<br>` +
      `Owner: ${hex.owner ? hex.owner.name : 'None'}<br>` +
      `Soldier: ${hex.soldier ? 'Yes' : 'No'}<br>` +
      `Fort: ${hex.fort ? 'Yes' : 'No'}`;
  } else {
    tooltip.style.visibility = 'hidden';
  }
});

createHexGrid();
drawGrid();
updateUI();
</script>

</body>
</html>